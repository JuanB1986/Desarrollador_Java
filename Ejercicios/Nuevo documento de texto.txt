package com.Ejercicio_Integrador;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

public class Inscripcion{

	private List<Alumno> listaAlumnos;
	private List<Materia> listaMaterias;
	private LocalDateTime fecha;
	private List<Integer> estadoInscripcion;

	
	public Inscripcion() {
		listaAlumnos = new ArrayList<Alumno>();
		listaMaterias = new ArrayList<Materia>();		
		estadoInscripcion = new ArrayList<Integer>();
		
	}
	
	public void setAlumno(Alumno alumno) {
		this.listaAlumnos.add(alumno);
	}
	
	public void setMateria(Materia materia) {
		this.listaMaterias.add(materia);
	}
	
	public int indexAlumno(String nombre) {
		for (int i=0;i<this.listaAlumnos.size();++i) {
			if (this.listaAlumnos.get(i).getNombre().equals(nombre)) {
				return i;
			}
		}
		return -1;
	}
	
	
	
	
	public void getInscripciones(String ruta) throws IOException {
		
		//Lee archivo de inscriptos.
		List<String> nombreAlumnoInscripto  = new ArrayList<String>();
		List<String> materiaAlumnoInscripto = new ArrayList<String>();		
		List<Integer> estadoInscripcion = new ArrayList<Integer>();
		
		String archivo = Files.readString(Paths.get(ruta));
		
		String separador[]=archivo.split(",");
		
		for (int i=0; i<separador.length/2;++i) {
			nombreAlumnoInscripto.add(separador[i*2].strip());
			materiaAlumnoInscripto.add(separador[(2*i)+1].strip());			
		}	
		
		/*******************************************************************/
		
		int temp=0;
		
		//Busca alumno inscripto en la lista de alumnos
		for (int i=0; i<nombreAlumnoInscripto.size();++i) {
			temp=-1;
			for (int k=0;k < listaAlumnos.size();++k) {
				if (nombreAlumnoInscripto.get(i).equals(listaAlumnos.get(k).getNombre())) {
					temp=1;			
				}				 
			}
			estadoInscripcion.add(temp);				
		}
		
		
		//Busca materia en la que se anoto y guarda el puntero
		for (int i=0; i<nombreAlumnoInscripto.size();++i) {
			if(estadoInscripcion.get(i)==1) {
				temp=-1;
				for (int k=0;k < listaMaterias.size();++k) {
					if (materiaAlumnoInscripto.get(i).equals(listaMaterias.get(k).getNombre())) {
						temp=k;
					}
				}
				estadoInscripcion.set(i, temp);				
			}
			//System.out.println(estadoInscripcion.get(i));
		}
		
		
		//Busca si tiene materia correlativa aprobada
		for (int i=0; i<nombreAlumnoInscripto.size();++i) {	//recorre lista de inscriptos
			if(estadoInscripcion.get(i)>=0) {		
				temp=-2;
				for (int k=0; k< listaMaterias.get(i).getCorrelativas().size(); ++k){	//lista correlativas de las materias en las que se anotaron
					
					String correlativa= listaMaterias.get(i).getCorrelativas().get(k);
					
					int indice = this.indexAlumno(nombreAlumnoInscripto.get(i));
										
					if ( indice>=0) 
					{					
						for (int h=0; h<listaAlumnos.get(indice).getMateriasAprobadas().size();++h) {
							
							if (correlativa == null) {							
								estadoInscripcion.set(i, 1);
								//System.out.println(correlativa +" "+ listaAlumnos.get(indice).getNombre());
							}
							else 
							{
								if (listaAlumnos.get(indice).getMateriasAprobadas().get(h).equals(correlativa)) 
								{
									estadoInscripcion.set(i, 1);
									//System.out.println(correlativa +" "+ listaAlumnos.get(indice).getNombre());
								}

							}
						}
					}	
					
					
				}
				
			}
			
		}
		
		System.out.println("e "+estadoInscripcion.get(0));
		System.out.println("e "+estadoInscripcion.get(1));
		System.out.println("e "+estadoInscripcion.get(2));
		System.out.println("e "+estadoInscripcion.get(3));
		System.out.println("e "+estadoInscripcion.get(4));
		
		
}
	
	
	
	
	
	
	
	
	
}




/*
 		
		//Procesa solicitudes
		int i=0,j=0;	
		boolean flag;
		for (i=0; i<nombreAlumnoInscripto.size();++i){
			
			if (!nombreAlumnoInscripto.get(i).isEmpty()) {
				
				//Busqueda de alumno inscripto en la lista			
				for (j=0; j<this.listaAlumnos.size();++j) {										
					if(nombreAlumnoInscripto.get(i).equals(this.listaAlumnos.get(j).getNombre())){
						System.out.println(this.listaAlumnos.get(j).getNombre());
						
				
						
						
					}
					
				}					
				
			}		
			
		}

 */

